# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
Write a SQL query to List departments with names longer than the average length

```sql
SELECT department_id, department_name
FROM Departments
WHERE LENGTH(department_name) > (
    SELECT AVG(LENGTH(department_name)) FROM Departments
);

```

**Output:**

<img width="575" height="471" alt="image" src="https://github.com/user-attachments/assets/6679601b-fe3f-46c0-8fe3-b79961bac793" />

**Question 2**
---
From the following tables write a SQL query to find all orders generated by London-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

```sql
SELECT o.ord_no, o.purch_amt, o.ord_date, o.customer_id, o.salesman_id
FROM orders AS o
JOIN salesman AS s
ON o.salesman_id = s.salesman_id
WHERE s.city = 'London';
```

**Output:**

<img width="1255" height="469" alt="image" src="https://github.com/user-attachments/assets/47cc55e0-048b-4e69-9eb6-d8967dd1c512" />

**Question 3**
---
Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the minimum grade achieved in each subject.

```sql
SELECT student_name,  grade
FROM GRADES g
WHERE grade = (
    SELECT MIN(grade)
    FROM GRADES
    WHERE subject = g.subject
);
```

**Output:**

<img width="782" height="505" alt="image" src="https://github.com/user-attachments/assets/ae167ffd-0d02-47ce-8ba8-37f0c75b275d" />

**Question 4**
---
From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.
```sql
SELECT o.ord_no, o.purch_amt, o.ord_date, o.customer_id, o.salesman_id
FROM orders AS o
JOIN salesman AS s
ON o.salesman_id = s.salesman_id
WHERE s.city = 'New York';
```

**Output:**

<img width="1254" height="525" alt="image" src="https://github.com/user-attachments/assets/0f96f157-c312-42a4-b436-41807bcffb4e" />

**Question 5**
---
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 1 million

```sql
SELECT id, name, age, city, income
FROM Employee
WHERE age < (
    SELECT AVG(age)
    FROM Employee
    WHERE income > 1000000
);

```

**Output:**

<img width="1266" height="486" alt="image" src="https://github.com/user-attachments/assets/5440fa2e-aa5f-460e-aca9-dfb274ba25bb" />

**Question 6**
---
From the following tables, write a SQL query to find those salespeople who earned the maximum commission. Return ord_no, purch_amt, ord_date, and salesman_id.

```sql
SELECT o.ord_no, o.purch_amt, o.ord_date, o.salesman_id
FROM orders AS o
JOIN salesman AS s
ON o.salesman_id = s.salesman_id
WHERE s.commission = (
    SELECT MAX(commission)
    FROM salesman
);
```

**Output:**

<img width="997" height="533" alt="image" src="https://github.com/user-attachments/assets/7fc12d7b-4aa9-4107-89fd-75467dd6b7a8" />

**Question 7**
---
Write a SQL query that retrieves the all the columns from the Table Grades, where the grade is equal to the minimum grade achieved in each subject.

```sql
SELECT *
FROM GRADES g
WHERE grade = (
    SELECT MIN(grade)
    FROM GRADES
    WHERE subject = g.subject
);

```

**Output:**


**Question 8**
---
Write a SQL query to Retrieve the names of customers who have a phone number that is not shared with any other customer.

```sql
SELECT name
FROM customer
WHERE phone IN (
    SELECT phone
    FROM customer
    GROUP BY phone
    HAVING COUNT(phone) = 1
);
```

**Output:**

<img width="443" height="541" alt="image" src="https://github.com/user-attachments/assets/cb7b79c0-6180-4883-b680-ac1a581d0526" />

**Question 9**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is EQUAL TO $1500.

```sql
SELECT *
FROM CUSTOMERS
WHERE SALARY = 1500;
```

**Output:**

<img width="1232" height="401" alt="image" src="https://github.com/user-attachments/assets/5e6d6e33-5d24-4aba-9961-317dc30549a3" />

**Question 10**
---
From the following tables, write a SQL query to find all the orders generated in New York city. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

```sql
SELECT o.ord_no, o.purch_amt, o.ord_date, o.customer_id, o.salesman_id
FROM orders o
JOIN salesman s ON o.salesman_id = s.salesman_id
WHERE s.city = 'New York';
```

**Output:**

<img width="1244" height="547" alt="image" src="https://github.com/user-attachments/assets/bb4d5e62-37cc-4d4e-9305-a8f0ad5c2858" />

**SEB Grades:**

<img width="1072" height="74" alt="Screenshot 2025-11-13 213244" src="https://github.com/user-attachments/assets/af30b525-1703-4f88-a61f-4bda79cf6d41" />


## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
